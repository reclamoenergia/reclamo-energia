<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Pagamento riuscito - ReclamoEnergia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{--blue:#2F5FA7;--green:#2E8B57;--bg:#f4f6f8;--muted:#6b7280;}
    body{font-family:Arial,sans-serif;margin:0;background:var(--bg);color:#111827;}
    .wrap{max-width:720px;margin:0 auto;padding:28px 16px 60px;}
    .card{background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:22px;text-align:center;}
    h1{margin:0 0 10px;color:var(--green);font-size:26px}
    p{margin:0 0 14px;color:var(--muted);line-height:1.45}
    .btn{
      display:inline-block;padding:12px 16px;border-radius:10px;border:1px solid var(--blue);
      background:var(--blue);color:#fff;font-weight:900;font-size:16px;text-decoration:none;
    }
    .btn:hover{opacity:.93}
    .box{margin-top:16px;border:1px solid #e5e7eb;background:#f9fafb;border-radius:14px;padding:14px;text-align:left;}
    .box b{color:#111827}
    .small{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.45}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Pagamento riuscito ✅</h1>
      <p>Grazie. Nei prossimi step automatizzeremo PDF ed email. Per ora puoi inviare il reclamo copiando il testo dalla pagina precedente.</p>

      <a class="btn" href="./">Torna alla homepage</a>

      <br><br>
      <button class="btn" style="background:#2E8B57;border-color:#2E8B57;" onclick="downloadPdf()">Scarica PDF</button>
      <div class="small" id="pdfMsg" style="margin-top:10px;"></div>

     <div class="box">
        <b>Prossimi passi</b>
        <div class="small">
          1) Scarica il PDF del documento cliccando sul pulsante qui sopra.<br>
          2) Invia il documento via email o PEC al tuo fornitore.<br>
          3) Conserva copia del messaggio inviato e dell’eventuale ricevuta.<br><br>
          Se non ricevi risposta entro un termine ragionevole, potrai utilizzare il documento come prova dell’avvenuta comunicazione.
        </div>
      </div>


      <div class="small">
        Il servizio fornisce modelli standard di comunicazione e non costituisce consulenza legale.
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

              <script>
                function downloadPdf(){
                  const msg = document.getElementById('pdfMsg');
                  msg.textContent = '';
              
                  let raw = null;
                  try {
                    raw = localStorage.getItem('reclamoenergia_last_doc');
                  } catch(e){}
              
                  if(!raw){
                    msg.textContent = "Non trovo il documento in questo browser. Torna indietro alla pagina del documento e riprova.";
                    return;
                  }
              
                  let payload;
                  try {
                    payload = JSON.parse(raw);
                  } catch(e){
                    msg.textContent = "Documento non valido. Torna indietro alla pagina del documento e riprova.";
                    return;
                  }
              
                  const text = payload.text || '';
                  if(!text.trim()){
                    msg.textContent = "Documento vuoto. Torna indietro alla pagina del documento e riprova.";
                    return;
                  }
              
                  const { jsPDF } = window.jspdf;
                  const doc = new jsPDF({ unit: "pt", format: "a4" });
              
                  const pageWidth = doc.internal.pageSize.getWidth();
                  const pageHeight = doc.internal.pageSize.getHeight();
              
                  const margin = 56;
                  const maxWidth = pageWidth - margin*2;
                  const lineHeight = 16;
              
                  doc.setFont("times", "normal");
                  doc.setFontSize(12);
              
                  const lines = doc.splitTextToSize(text, maxWidth);
              
                  let y = margin;
                  for (let i = 0; i < lines.length; i++) {
                    if (y > pageHeight - margin) {
                      doc.addPage();
                      y = margin;
                    }
                    doc.text(lines[i], margin, y);
                    y += lineHeight;
                  }
              
                  const filename = payload.filename || "ReclamoEnergia.pdf";
                  doc.save(filename);
                  msg.textContent = "PDF scaricato ✅";
                }
              </script>

  
</body>
</html>
